function getCityList(){var i=$("#provinceSelect"),n=$("#citySelect"),t=$("#districtSelect");$.getJSON("http://restapi.amap.com/v3/config/district?key=1ff97f3d9068e5e12e21f3c34480096a&subdistrict=1&level=province&keywords="+i.val()).success(function(i){if(i.status==1)if(n.empty(),i.districts[0].districts.length>0)$.each(i.districts[0].districts,function(t,i){$("<option><\/option>").val(i.adcode).text(i.name).appendTo(n)}),getDistrictList();else{var r=i.districts[0];$("<option><\/option>").val(r.adcode).text(r.name).appendTo(n);t.empty();appendDistrictItem(r,t.get(0).tagName)}})}function getDistrictList(){var t=$("#citySelect"),n=$("#districtSelect");$.getJSON("http://restapi.amap.com/v3/config/district?key=1ff97f3d9068e5e12e21f3c34480096a&subdistrict=1&level=city&keywords="+t.val()).success(function(t){if(t.status==1)if(n.empty(),t.districts[0].districts.length>0)$.each(t.districts[0].districts,function(t,i){appendDistrictItem(i,n.get(0).tagName)});else{var i=t.districts[0];appendDistrictItem(i,n.get(0).tagName)}})}function appendDistrictItem(n,t){var u=$("#provinceSelect"),f=$("#citySelect"),r=$("#districtSelect"),i=$("#Districts"),e;if(t.toLowerCase()=="select"){$("<option><\/option>").val(n.adcode).text(n.name).appendTo(r);return}e=$('<input type="checkbox" />').val(n.adcode).text(n.name).attr("id",n.adcode).prop("checked",i.find("#li_"+n.adcode).size()!=0).click(function(){if($(this).prop("checked")){if(i.find("#li_"+n.adcode).size()!=0)return;var h=u.val(),e=u.find("option:selected").text(),c=f.val(),o=f.find("option:selected").text(),t=n.adcode,s=n.name,l=$('<span class="input-group-btn"><\/span>').append($('<button class="btn btn-default remove-district" type="button">&times;<\/button>').val(t).click(function(){i.find("#li_"+t).remove();r.find("#"+t).prop("checked",!1);AdjustDistrictHiddenInputName()})),a=$('<div class="input-group"><\/div>').append($('<input type="button" class="text-left form-control" />').val(e+" "+o+" "+s)).append(l);$("<li><\/li>").append(a).append($('<input type="hidden" />').val(h)).append($('<input type="hidden" />').val(e)).append($('<input type="hidden" />').val(c)).append($('<input type="hidden" />').val(o)).append($('<input type="hidden" />').val(t)).append($('<input type="hidden" />').val(s)).attr("id","li_"+t).appendTo(i);AdjustDistrictHiddenInputName()}else i.find("#li_"+n.adcode).remove(),AdjustDistrictHiddenInputName()});$("<li><\/li>").append($('<div class="checkbox"><\/div>').append(e).append($("<label><label>").attr("for",n.adcode).text(n.name))).appendTo(r)}function AdjustDistrictHiddenInputName(){$("#Districts").children("li").each(function(n){$(this).find("input[type=hidden]").first().attr("name","Districts["+n+"].ProvinceAdcode").next().attr("name","Districts["+n+"].ProvinceName").next().attr("name","Districts["+n+"].CityAdcode").next().attr("name","Districts["+n+"].CityName").next().attr("name","Districts["+n+"].DistrictAdcode").next().attr("name","Districts["+n+"].DistrictName")})}function getJobClassList(){var n=$("#jobCategorySelect"),t=$("#jobClassSelect");$.getJSON("../../../api/jobClass",{categoryId:n.val()}).success(function(n){n&&(t.empty(),n.length>0&&$.each(n,function(n,t){appendJobClassItem(t)}))})}function appendJobClassItem(n){var i=$("#jobCategorySelect"),r=$("#jobClassSelect"),t=$("#JobClasses"),u=t.find("#li_job_"+n.id),f=$('<input type="checkbox" />').val(n.id).text(n.name).attr("id","job_"+n.id).prop("checked",u.size()!=0).click(function(){if($(this).prop("checked")){if(t.find("#li_job_"+n.id).size()!=0)return;var o=i.val(),f=i.find("option:selected").text(),u=n.id,e=n.name,s=$('<div class="input-group-btn"><\/span>').append($('<button type="button" class="btn btn-default dropdown-toggle jobgrade-select" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">').append($("<span><\/span>").text("\u6807\u51c6\u5de5")).append($('<span class="caret"><\/span><\/button>'))),h=$('<ul class="dropdown-menu dropdown-menu-right">').append($('<li><a href="#" data-jobgrade="0" class="jobgrade-option">\u6807\u51c6\u5de5<\/a><\/li>')).append($('<li><a href="#" data-jobgrade="1" class="jobgrade-option">\u5927\u3000\u5de5<\/a><\/li>')).append($('<li><a href="#" data-jobgrade="2" class="jobgrade-option">\u5c0f\u3000\u5de5<\/a><\/li>')),c=$('<span class="input-group-btn"><\/span>').append($('<button class="btn btn-default remove-jobclass" type="button">&times;<\/button>').val("job_"+u).click(function(){t.find("#li_job_"+u).remove();r.find("#job_"+u).prop("checked",!1);AdjustJobClassHiddenInputName()})),l=$('<div class="input-group"><\/div>').append($('<input type="button" class="text-left form-control" />').val(f+" "+e)).append(s.append(h)).append(c);$("<li><\/li>").append($('<input type="hidden" />').val(o)).append($('<input type="hidden" />').val(f)).append($('<input type="hidden" />').val(u)).append($('<input type="hidden" />').val(e)).append($('<input type="hidden" />').val(0)).append(l).attr("id","li_job_"+u).appendTo(t);AdjustJobClassHiddenInputName();AttachJobGradeSelectEvent()}else t.find("#li_job_"+n.id).remove(),AdjustJobClassHiddenInputName()});$("<li><\/li>").append($('<div class="checkbox"><\/div>').append(f).append($("<label><label>").attr("for","job_"+n.id).text(n.name))).appendTo(r)}function AdjustJobClassHiddenInputName(){$("#JobClasses").children("li").each(function(n){$(this).find("select").attr("name","JobClasses["+n+"].Grade");$(this).find("input[type=hidden]").first().attr("name","JobClasses["+n+"].JobCategoryId").next().attr("name","JobClasses["+n+"].JobCategoryName").next().attr("name","JobClasses["+n+"].JobClassId").next().attr("name","JobClasses["+n+"].JobClassName").next().attr("name","JobClasses["+n+"].Grade")})}function AttachJobGradeSelectEvent(){$(".jobgrade-option").click(function(){event.preventDefault();var n=$(this).attr("data-jobgrade"),t=$(this).text();$(this).parents(".input-group-btn").children("button").find("span").first().text(t);$(this).parents(".input-group").prev().val(n)})}function TriggerHeaderDisplay(){$("#IsHead").prop("checked")?$("#HeaderSearchDiv").slideUp():$("#HeaderSearchDiv").slideDown()}function searchHeader(){var n=$("#HeaderName");$.getJSON("../../../api/worker/header",{search:n.val()}).success(function(t){var i=$("#HeaderDropDown");i.empty();$("<li><\/li>").append($('<button class="btn-link btn"><\/button>').text("\u6ca1\u6709\u73ed\u957f").click(function(){console.info(2);event.preventDefault();n.val("");n.attr("data-stb-header","");$("#HeaderId").val(null)})).appendTo(i);$.each(t,function(t,r){var u=$('<button class="btn-link btn"><\/button>').text(r.name+"   "+r.userName).click(function(){event.preventDefault();n.val(r.name);n.attr("data-stb-header",r.name);$("#HeaderId").val(r.id)});r.userName==$("#UserName").val()&&u.prop("disabled","true");$("<li><\/li>").append(u).appendTo(i)})})}function onContractorSelected(n){$("#ContractorId").val(n.id);$("#ContractorName").val(n.name);$("#ContractorStaffId").val(null);$("#ContractorStaffName").val(null);$("#ContractorStaffPhone").val(null);$("#ContractorStaffTypeahead").focus();$("#ContractorStaffTypeahead").typeahead("val","1");$("#ContractorStaffTypeahead").typeahead("val","")}function onContractorStaffSelected(n){$("#ContractorStaffId").val(n.id);$("#ContractorStaffName").val(n.name);$("#ContractorStaffPhone").val(n.phone);$("#ContractorStaffPhone").focus()}function onPlatoonSelected(n){$("#PlatoonId").val(n.id);$("#PlatoonName").val(n.name)}$(document).ready(function(){var n=$("#provinceSelect"),i,t;n.size()>0&&(i=$("#citySelect"),t=$("#districtSelect"),$.getJSON("http://restapi.amap.com/v3/config/district?key=1ff97f3d9068e5e12e21f3c34480096a&subdistrict=1").success(function(t){t.status==1&&(n.empty(),$.each(t.districts[0].districts,function(t,i){$("<option><\/option>").val(i.adcode).text(i.name).appendTo(n)}),getCityList())}),n.change(function(){getCityList()}),i.change(function(){getDistrictList()}),$("#selectAllDistrict").click(function(){$(this).prop("checked")?t.find("input:unchecked").click():t.find("input:checked").click()}))});$(document).ready(function(){$(".remove-district").click(function(){var n=$(this).val();$("#Districts").find("#li_"+n).remove();$("#districtSelect").find("#"+n).prop("checked",!1);AdjustDistrictHiddenInputName()})});$(document).ready(function(){var n=$("#jobCategorySelect"),t;n.size()>0&&(t=$("#jobClassSelect"),$.getJSON("../../../api/jobCategory").success(function(t){t.length>0&&(n.empty(),$.each(t,function(t,i){$("<option><\/option>").val(i.id).text(i.name).appendTo(n)}),getJobClassList())}),n.change(function(){getJobClassList()}),$("#selectAllJobClass").click(function(){$(this).prop("checked")?t.find("input:unchecked").click():t.find("input:checked").click()}))});$(document).ready(function(){$(".remove-jobclass").click(function(){var n=$(this).val();$("#JobClasses").find("#li_"+n).remove();$("#jobClassSelect").find("#"+n).prop("checked",!1);AdjustJobClassHiddenInputName()})});$(document).ready(function(){AttachJobGradeSelectEvent()});$(document).ready(function(){var n,t=600;$("#HeaderName").focusin(function(){window.clearTimeout(n);var t=$(this);n=window.setTimeout(function(){t.select();searchHeader()},100)}).focusout(function(){var n=$(this);window.setTimeout(function(){var t=n.attr("data-stb-header");t&&t!=n.val()&&n.val(t)},300)});$("#HeaderName").bind("input",function(){window.clearTimeout(n);n=window.setTimeout(function(){searchHeader()},t)});$("#IsHead").click(function(){TriggerHeaderDisplay()});TriggerHeaderDisplay()});$(document).ready(function(){if($("#ContractorTypeahead").size()!=0){$.validator&&$.validator.setDefaults({ignore:""});var n=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,limit:10,identify:function(n){return n.id},remote:{url:"../../../api/Contractor/Search?search=%QUERY",wildcard:"%QUERY",rateLimitWait:200}}),t=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,limit:10,identify:function(n){return n.id},remote:{url:"../../../api/ContractorStaff/Search?contractorId=%CONTRACTORID&search=%QUERY",prepare:function(n,t){return t.url=t.url.replace("%CONTRACTORID",$("#ContractorId").val()).replace("%QUERY",n),t},rateLimitWait:200}}),r=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,limit:10,identify:function(n){return n.id},remote:{url:"../../../api/Platoon/Search?search=%QUERY",wildcard:"%QUERY",rateLimitWait:200}});$("#ContractorTypeahead").typeahead({hint:!1,highlight:!0,minLength:0},{name:"contractors",display:"name",source:n});$("#ContractorStaffTypeahead").typeahead({hint:!1,highlight:!0,minLength:0},{name:"contractorStaffs",display:"name",source:t});$("#PlatoonTypeahead").typeahead({hint:!1,highlight:!0,minLength:0},{name:"platoons",display:"name",source:r});$("#ContractorName").val()&&(console.log($("#ContractorName").val()),$("#ContractorTypeahead").typeahead("val",$("#ContractorName").val()));$("#ContractorStaffName").val()&&$("#ContractorStaffTypeahead").typeahead("val",$("#ContractorStaffName").val());$("#PlatoonName").val()&&$("#PlatoonTypeahead").typeahead("val",$("#PlatoonName").val());$("#ContractorTypeahead").bind("typeahead:change",function(t,r){$("#ContractorName").val()!=r&&n.search(r,function(){},function(n){for(i=0;i<n.length;i++)if(n[i].name==r){onContractorSelected(n[i]);return}$("#ContractorId").val(null);$("#ContractorName").val(r);$("#ContractorStaffId").val(null);$("#ContractorStaffName").val(null);$("#ContractorStaffPhone").val(null);$("#ContractorStaffTypeahead").typeahead("val","1");$("#ContractorStaffTypeahead").typeahead("val","");$("#ContractorStaffTypeahead").focus()})});$("#ContractorStaffTypeahead").bind("typeahead:change",function(n,r){$("#ContractorStaffName").val()!=r&&t.search(r,function(){},function(n){for(i=0;i<n.length;i++)if(n[i].name==r){onContractorStaffSelected(n[i]);return}$("#ContractorStaffId").val(null);$("#ContractorStaffName").val(r);$("#ContractorStaffPhone").val(null);$("#ContractorStaffPhone").focus()})});$("#PlatoonTypeahead").bind("typeahead:change",function(n,t){$("#PlatoonName").val()!=t&&r.search(t,function(){},function(n){for(i=0;i<n.length;i++)if(n[i].name==t){onPlatoonSelected(n[i]);return}$("#PlatoonId").val(null);$("#PlatoonTypeahead").typeahead("val","")})});$("#ContractorTypeahead").bind("typeahead:autocomplete ",function(n,t){onContractorSelected(t)});$("#ContractorTypeahead").bind("typeahead:select",function(n,t){onContractorSelected(t)});$("#ContractorStaffTypeahead").bind("typeahead:autocomplete ",function(n,t){onContractorStaffSelected(t)});$("#ContractorStaffTypeahead").bind("typeahead:select",function(n,t){onContractorStaffSelected(t)});$("#PlatoonTypeahead").bind("typeahead:autocomplete ",function(n,t){onPlatoonSelected(t)});$("#PlatoonTypeahead").bind("typeahead:select ",function(n,t){onPlatoonSelected(t)})}});