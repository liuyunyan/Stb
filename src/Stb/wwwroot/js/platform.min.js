function clearPlatoon(){var n=$("#PlatoonTypeahead");n&&($("#PlatoonTypeahead").typeahead("val","-1"),$("#PlatoonTypeahead").typeahead("val",""),$("#PlatoonId").val(null),$("#PlatoonName").val(null))}function getCityList(){var t=$("#provinceSelect"),n=$("#citySelect"),i;t.find("option:selected").val()&&(i=$("#districtSelect"),$.getJSON("http://restapi.amap.com/v3/config/district?key=1ff97f3d9068e5e12e21f3c34480096a&subdistrict=1&level=province&keywords="+t.val()).success(function(t){var r,u;t.status==1&&(t.districts[0].districts.length>0?($("<option><\/option>").val(null).text("请选择所在城市").appendTo(n),$.each(t.districts[0].districts,function(t,i){$("<option><\/option>").val(i.adcode).text(i.name).appendTo(n)})):(r=t.districts[0],$("#District_CityAdcode").val(r.adcode),$("#District_DistrictAdcode").val(r.adcode),$("<option><\/option>").val(r.adcode).text(r.name).appendTo(n),appendDistrictItem(r,i.get(0).tagName)),districtUtil.cityInited||(districtUtil.cityInited=!0,u=$("#District_CityAdcode"),u.val()&&(n.find("option[value="+u.val()+"]").attr("selected",!0),getDistrictList())))}))}function getDistrictList(){var t=$("#citySelect"),n=$("#districtSelect");t.find("option:selected").val()&&$.getJSON("http://restapi.amap.com/v3/config/district?key=1ff97f3d9068e5e12e21f3c34480096a&subdistrict=1&level=city&keywords="+t.val()).success(function(t){var i,u,r;t.status==1&&(t.districts[0].districts.length>0?($("<option><\/option>").val(null).text("请选择所在区（县）").appendTo(n),$.each(t.districts[0].districts,function(t,i){appendDistrictItem(i,n.get(0).tagName)})):(i=t.districts[0],$("#District_DistrictAdcode").val(i.adcode),appendDistrictItem(i,n.get(0).tagName)),districtUtil.districtInited||(districtUtil.districtInited=!0,i=$("#District_DistrictAdcode"),i.val()&&(console.log(i.val()),n.find("option[value="+i.val()+"]").attr("selected",!0),districtUtil.platoonInited||(u=$("#PlatoonTypeahead"),u&&$("#PlatoonName").val()&&($("#PlatoonTypeahead").typeahead("val","-1"),$("#PlatoonTypeahead").typeahead("val",$("#PlatoonName").val()))),lbs&&!lbs.locationInited&&(lbs.locationInited=!0,r=$("#WorkAddress"),lbs.geocoder.setCity(i.val()),console.log(r.val()),r.val()?getAddressLocation():i.val()?lbs.map.setCity(i.val()):lbs.map.setCity("北京市")))))})}function appendDistrictItem(n,t){var u=$("#provinceSelect"),f=$("#citySelect"),r=$("#districtSelect"),i=$("#Districts"),e;if(t.toLowerCase()=="select"){$("<option><\/option>").val(n.adcode).text(n.name).appendTo(r);return}e=$('<input type="checkbox" />').val(n.adcode).text(n.name).attr("id",n.adcode).prop("checked",i.find("#li_"+n.adcode).size()!=0).click(function(){if($(this).prop("checked")){if(i.find("#li_"+n.adcode).size()!=0)return;var h=u.val(),e=u.find("option:selected").text(),c=f.val(),o=f.find("option:selected").text(),t=n.adcode,s=n.name,l=$('<span class="input-group-btn"><\/span>').append($('<button class="btn btn-default remove-district" type="button">&times;<\/button>').val(t).click(function(){i.find("#li_"+t).remove();r.find("#"+t).prop("checked",!1);AdjustDistrictHiddenInputName()})),a=$('<div class="input-group"><\/div>').append($('<input type="button" class="text-left form-control" />').val(e+" "+o+" "+s)).append(l);$("<li><\/li>").append(a).append($('<input type="hidden" />').val(h)).append($('<input type="hidden" />').val(e)).append($('<input type="hidden" />').val(c)).append($('<input type="hidden" />').val(o)).append($('<input type="hidden" />').val(t)).append($('<input type="hidden" />').val(s)).attr("id","li_"+t).appendTo(i);AdjustDistrictHiddenInputName()}else i.find("#li_"+n.adcode).remove(),AdjustDistrictHiddenInputName()});$("<li><\/li>").append($('<div class="checkbox"><\/div>').append(e).append($("<label><label>").attr("for",n.adcode).text(n.name))).appendTo(r)}function AdjustDistrictHiddenInputName(){$("#Districts").children("li").each(function(n){$(this).find("input[type=hidden]").first().attr("name","Districts["+n+"].ProvinceAdcode").next().attr("name","Districts["+n+"].ProvinceName").next().attr("name","Districts["+n+"].CityAdcode").next().attr("name","Districts["+n+"].CityName").next().attr("name","Districts["+n+"].DistrictAdcode").next().attr("name","Districts["+n+"].DistrictName")})}function getJobClassList(){var n=$("#jobCategorySelect"),t=$("#jobClassSelect");$.getJSON("../../../api/jobClass",{categoryId:n.val()}).success(function(n){n&&(t.empty(),n.length>0&&$.each(n,function(n,t){appendJobClassItem(t)}))})}function appendJobClassItem(n){var i=$("#jobCategorySelect"),r=$("#jobClassSelect"),t=$("#JobClasses"),u=t.find("#li_"+n.id),f=$('<input type="checkbox" />').val(n.id).text(n.name).attr("id",""+n.id).prop("checked",u.size()!=0).click(function(){if($(this).prop("checked")){if(t.find("#li_"+n.id).size()!=0)return;var o=i.val(),f=i.find("option:selected").text(),u=n.id,e=n.name,s=$('<div class="input-group-btn"><\/span>').append($('<button type="button" class="btn btn-default dropdown-toggle jobgrade-select" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">').append($("<span><\/span>").text("标准工")).append($('<span class="caret"><\/span><\/button>'))),h=$('<ul class="dropdown-menu dropdown-menu-right">').append($('<li><a href="#" data-jobgrade="0" class="jobgrade-option">标准工<\/a><\/li>')).append($('<li><a href="#" data-jobgrade="1" class="jobgrade-option">大　工<\/a><\/li>')).append($('<li><a href="#" data-jobgrade="2" class="jobgrade-option">小　工<\/a><\/li>')),c=$('<span class="input-group-btn"><\/span>').append($('<button class="btn btn-default remove-jobclass" type="button">&times;<\/button>').val(""+u).click(function(){t.find("#li_"+u).remove();r.find("#"+u).prop("checked",!1);AdjustJobClassHiddenInputName();$("#BestJobClassId").find("option[value="+n.id+"]").remove()})),l=$('<div class="input-group"><\/div>').append($('<input type="button" class="text-left form-control" />').val(f+" "+e)).append(s.append(h)).append(c);$("<li><\/li>").append($('<input type="hidden" />').val(o)).append($('<input type="hidden" />').val(f)).append($('<input type="hidden" />').val(u)).append($('<input type="hidden" />').val(e)).append($('<input type="hidden" />').val(0)).append(l).attr("id","li_"+u).appendTo(t);AdjustJobClassHiddenInputName();AttachJobGradeSelectEvent();$("#BestJobClassId").append($("<option><\/option>").val(u).text(f+" "+e))}else t.find("#li_"+n.id).remove(),AdjustJobClassHiddenInputName(),$("#BestJobClassId").find("option[value="+n.id+"]").remove()});$("<li><\/li>").append($('<div class="checkbox"><\/div>').append(f).append($("<label><label>").attr("for",""+n.id).text(n.name))).appendTo(r)}function AdjustJobClassHiddenInputName(){$("#JobClasses").children("li").each(function(n){$(this).find("select").attr("name","JobClasses["+n+"].Grade");$(this).find("input[type=hidden]").first().attr("name","JobClasses["+n+"].JobCategoryId").next().attr("name","JobClasses["+n+"].JobCategoryName").next().attr("name","JobClasses["+n+"].JobClassId").next().attr("name","JobClasses["+n+"].JobClassName").next().attr("name","JobClasses["+n+"].Grade")})}function AttachJobGradeSelectEvent(){$(".jobgrade-option").click(function(){event.preventDefault();var n=$(this).attr("data-jobgrade"),t=$(this).text();$(this).parents(".input-group-btn").children("button").find("span").first().text(t);$(this).parents(".input-group").prev().val(n)})}function TriggerHeaderDisplay(){$("#IsHeader").prop("checked")?$("#HeaderSearchDiv").slideUp():$("#HeaderSearchDiv").slideDown()}function searchHeader(){var n=$("#HeaderName");$.getJSON("../../../api/worker/header",{search:n.val()}).success(function(t){var i=$("#HeaderDropDown");i.empty();$("<li><\/li>").append($('<button class="btn-link btn"><\/button>').text("没有班长").click(function(){console.info(2);event.preventDefault();n.val("");n.attr("data-stb-header","");$("#HeaderId").val(null)})).appendTo(i);$.each(t,function(t,r){var u=$('<button class="btn-link btn"><\/button>').text(r.name+"   "+r.userName).click(function(){event.preventDefault();n.val(r.name);n.attr("data-stb-header",r.name);$("#HeaderId").val(r.id)});r.userName==$("#UserName").val()&&u.prop("disabled","true");$("<li><\/li>").append(u).appendTo(i)})})}function onContractorSelected(n){$("#ContractorId").val(n.id);$("#ContractorName").val(n.name);$("#ContractorStaffId").val(null);$("#ContractorStaffName").val(null);$("#ContractorStaffPhone").val(null);$("#ContractorStaffTypeahead").focus();$("#ContractorStaffTypeahead").typeahead("val","1");$("#ContractorStaffTypeahead").typeahead("val","")}function onContractorStaffSelected(n){$("#ContractorStaffId").val(n.id);$("#ContractorStaffName").val(n.name);$("#ContractorStaffPhone").val(n.phone);$("#ContractorStaffPhone").focus()}function onPlatoonSelected(n){$("#PlatoonId").val(n.id);$("#PlatoonName").val(n.name)}function getWorkerList(){var n=$("#WorkerSearchInput");$.getJSON("../../../api/worker",{search:n.val()}).success(function(n){var t=$("#WorkerTableBody");t.empty();$.each(n,function(n,i){var f=$('<a target="_blank"><\/a>').attr("href","/platform/Worker/Details/"+i.id+"?blank=true").text(i.name).prepend('<span class="glyphicon glyphicon-user" aria-hidden="true"><\/span>'),r="",u;r=i.isHeader?"班长":i.isCandidate?"侯选班长":"工人";u=$('<a href="#">添加<\/a>');u.click(function(n){var t,u,e,o;if(n.preventDefault(),$("#workerList").find("tr[data-worker-id = "+i.id+"]").size()>0){bootstrap_alert.warning("#SelectWorkerAlertHolder","该工人已经在列表中！",2e3);return}t=$("<td><\/td>");u=$('<a href="#">删除<\/a>');u.click(function(n){n.preventDefault();$(this).parents("tr").remove()});t.append(u);(i.isHeader||i.isCandidate)&&(setLeaderBtn=$('<a href="#">设为本工单班长<\/a>'),setLeaderBtn.click(function(n){n.preventDefault();$(this).text()=="设为本工单班长"?($.each($("#workerList").find("tr[data-is-leader=true]"),function(n,t){console.log(t);$(t).removeClass("text-success");$(t).attr("data-is-leader",!1);$(t).children("td").first().children("span").addClass("hidden");$(t).children("td").last().children("a").last().text("设为本工单班长");$(t).children("td").last().children("a").last().removeClass("text-success")}),$(this).text("取消本工单班长"),$(this).addClass("text-success"),$(this).parents("tr").attr("data-is-leader",!0),$(this).parents("tr").children("td").first().children("span").removeClass("hidden")):($(this).text("设为本工单班长"),$(this).removeClass("text-success"),$(this).parents("tr").attr("data-is-leader",!1),$(this).parents("tr").children("td").first().children("span").addClass("hidden"))}),t.append(" | ").append(setLeaderBtn));e=i.isCandidate?"班长(试单)":"班长";o=$("<tr><\/tr>").attr("data-worker-id",i.id).append($('<td><span class="text-warning hidden">'+e+"<\/span><\/td>")).append($("<td><\/td>").append(f.clone())).append($("<td><\/td>").text(i.userName)).append($("<td><\/td>").text(r)).append(t);$("#workerList").append(o)});$("<tr><\/tr>").append($("<td><\/td>").append(f)).append($("<td><\/td>").text(i.userName)).append($("<td><\/td>").text(r)).append($("<td><\/td>").append(u)).appendTo(t)})})}function getWorkLoadJobClassList(){var t=$("#workLoadJobCategorySelect"),n=$("#workLoadJobClassSelect");$.getJSON("../../../api/jobClass",{categoryId:t.val()}).success(function(t){t&&(n.empty(),t.length>0&&$.each(t,function(t,i){$("<option><\/option>").val(i.id).text(i.name).appendTo(n)}),getWorkLoadJobMeasurementList())})}function getWorkLoadJobMeasurementList(){var n=$("#workLoadJobClassSelect"),t=$("#workLoadJobMeasurementSelect");$.getJSON("../../../api/jobMeasurement",{classId:n.val()}).success(function(n){n&&(t.empty(),n.length>0&&$.each(n,function(n,t){appendJobMeasurementItem(t)}))})}function appendJobMeasurementItem(n){var f=$("#workLoadJobCategorySelect"),e=$("#workLoadJobClassSelect"),i=$("#workLoadJobMeasurementSelect"),t=$("#WorkLoads"),r=t.find("#li_"+n.id),u=$('<input type="checkbox" />').val(n.id).text(n.name).attr("id",""+n.id).prop("checked",r.size()!=0).click(function(){if($(this).prop("checked")){if(t.find("#li_"+n.id).size()!=0)return;var r=n.id,u=n.name,f=n.unit,e=$("#Id").val(),o=$('<input type="text" class="form-control" />').val(1),s=$('<span class="input-group-btn"><\/span>').append($('<button class="btn btn-default remove-workload" type="button">&times;<\/button>').val(""+r).click(function(){t.find("#li_"+r).remove();i.find("#"+r).prop("checked",!1);AdjustWorkLoadHiddenInputName()})),h=$('<div class="input-group"><\/div>').append($('<span class="input-group-addon"><\/span>').text(u)).append(o).append($('<span class="input-group-addon"><\/span>').text(f)).append(s);$("<li><\/li>").append($('<input type="hidden" />').val(r)).append($('<input type="hidden" />').val(u)).append($('<input type="hidden" />').val(e)).append($('<input type="hidden" />').val(null)).append(h).attr("id","li_"+r).appendTo(t);AdjustWorkLoadHiddenInputName();AttachJobGradeSelectEvent()}else t.find("#li_"+n.id).remove(),AdjustWorkLoadHiddenInputName()});$("<li><\/li>").append($('<div class="checkbox"><\/div>').append(u).append($("<label><label>").attr("for",""+n.id).text(n.name))).appendTo(i)}function AdjustWorkLoadHiddenInputName(){$("#WorkLoads").children("li").each(function(n){$(this).find("input[type=text]").first().attr("name","WorkLoads["+n+"].Amount");$(this).find("input[type=hidden]").first().attr("name","WorkLoads["+n+"].JobMeasurementId").next().attr("name","WorkLoads["+n+"].JobMeasurementName").next().attr("name","WorkLoads["+n+"].OrderId").next().attr("name","WorkLoads["+n+"].WorkerId")})}bootstrap_alert=function(){};$(document).ready(function(){var n;bootstrap_alert.warning=function(t,i,r){$(t).html('<div class="alert alert-warning fade in"><span>'+i+"<\/span><\/div>");window.clearTimeout(n);r&&(n=window.setTimeout(function(){$(t).children().first().alert("close")},r))};bootstrap_alert.danger=function(t,i,r){$(t).html('<div class="alert alert-danger fade in"><span>'+i+"<\/span><\/div>");window.clearTimeout(n);r&&(n=window.setTimeout(function(){$(t).children().first().alert("close")},r))};bootstrap_alert.success=function(t,i,r){$(t).html('<div class="alert alert-success fade in"><span>'+i+"<\/span><\/div>");window.clearTimeout(n);r&&(n=window.setTimeout(function(){$(t).children().first().alert("close")},r))}});var districtUtil={provinceInited:!1,cityInited:!1,districtInited:!1,platoonInited:!1};$(document).ready(function(){var n=$("#provinceSelect"),i,t;n.size()>0&&(i=$("#citySelect"),t=$("#districtSelect"),$.getJSON("http://restapi.amap.com/v3/config/district?key=1ff97f3d9068e5e12e21f3c34480096a&subdistrict=1").success(function(t){if(t.status==1&&($("<option><\/option>").val(null).text("请选择所在省（直辖市）").appendTo(n),$.each(t.districts[0].districts,function(t,i){$("<option><\/option>").val(i.adcode).text(i.name).appendTo(n)}),!districtUtil.provinceInited)){districtUtil.provinceInited=!0;var i=$("#District_ProvinceAdcode");i.val()&&(n.find("option[value="+i.val()+"]").attr("selected",!0),getCityList())}}),n.change(function(){$("#District_ProvinceAdcode").val($(this).find("option:selected").val());$("#District_CityAdcode").val(null);$("#District_DistrictAdcode").val(null);$("#citySelect").empty();$("#districtSelect").empty();clearPlatoon();getCityList()}),i.change(function(){$("#District_CityAdcode").val($(this).find("option:selected").val());$("#districtSelect").empty();clearPlatoon();getDistrictList()}),t.change(function(){$("#District_DistrictAdcode").val($(this).find("option:selected").val());clearPlatoon()}),$("#selectAllDistrict").click(function(){$(this).prop("checked")?t.find("input:unchecked").click():t.find("input:checked").click()}))});$(document).ready(function(){$(".remove-district").click(function(){var n=$(this).val();$("#Districts").find("#li_"+n).remove();$("#districtSelect").find("#"+n).prop("checked",!1);AdjustDistrictHiddenInputName()})});$(document).ready(function(){var n=$("#jobCategorySelect"),t;n.size()>0&&(t=$("#jobClassSelect"),$.getJSON("../../../api/jobCategory").success(function(t){t.length>0&&(n.empty(),$.each(t,function(t,i){$("<option><\/option>").val(i.id).text(i.name).appendTo(n)}),getJobClassList())}),n.change(function(){getJobClassList()}),$("#selectAllJobClass").click(function(){$(this).prop("checked")?t.find("input:unchecked").click():t.find("input:checked").click()}))});$(document).ready(function(){$(".remove-jobclass").click(function(){var n=$(this).val();console.log(n);$("#JobClasses").find("#li_"+n).remove();$("#jobClassSelect").find("#"+n).prop("checked",!1);AdjustJobClassHiddenInputName();$("#BestJobClassId").find("option[value="+n+"]").remove()})});$(document).ready(function(){AttachJobGradeSelectEvent()});$(document).ready(function(){var n,t=600;$("#HeaderName").focusin(function(){window.clearTimeout(n);var t=$(this);n=window.setTimeout(function(){t.select();searchHeader()},100)}).focusout(function(){var n=$(this);window.setTimeout(function(){var t=n.attr("data-stb-header");t&&t!=n.val()&&n.val(t)},300)});$("#HeaderName").bind("input",function(){window.clearTimeout(n);n=window.setTimeout(function(){searchHeader()},t)});$("#IsHeader").click(function(){TriggerHeaderDisplay()});TriggerHeaderDisplay()});$(document).ready(function(){if($("#ContractorTypeahead").size()!=0){$.validator&&$.validator.setDefaults({ignore:""});var n=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,limit:10,identify:function(n){return n.id},remote:{url:"../../../api/Contractor/Search?search=%QUERY",wildcard:"%QUERY",rateLimitWait:200}}),t=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,limit:10,identify:function(n){return n.id},remote:{url:"../../../api/ContractorStaff/Search?contractorId=%CONTRACTORID&search=%QUERY",prepare:function(n,t){return t.url=t.url.replace("%CONTRACTORID",$("#ContractorId").val()).replace("%QUERY",n),t},rateLimitWait:200}}),r=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,limit:10,identify:function(n){return n.id},remote:{url:"../../../api/Platoon/Search?districtId=%DISTRICTID&search=%QUERY",prepare:function(n,t){return t.url=t.url.replace("%DISTRICTID",$("#districtSelect").find("option:selected").val()).replace("%QUERY",n),t},rateLimitWait:200}});$("#ContractorTypeahead").typeahead({hint:!1,highlight:!0,minLength:0},{name:"contractors",display:"name",source:n,templates:{notFound:'<div class="empty-message">\n没有符合筛选条件的承包商<br />\n直接填写名称，系统将自动保存为新承包商<br />\n<\/div>',pending:'<div class="empty-message">\n正在检索…\n<\/div>',header:'<div class="empty-message">\n选择工单承包商\n<\/div>'}});$("#ContractorStaffTypeahead").typeahead({hint:!1,highlight:!0,minLength:0},{name:"contractorStaffs",display:"name",source:t,templates:{notFound:'<div class="empty-message">\n没有符合筛选条件的联系人<br />\n直接填写姓名，系统将自动添加至该承包商<br />\n<\/div>',pending:'<div class="empty-message">\n正在检索…\n<\/div>',header:'<div class="empty-message">\n选择工单联系人\n<\/div>'}});$("#PlatoonTypeahead").typeahead({hint:!1,highlight:!0,minLength:0},{name:"platoons",display:"name",source:r,templates:{notFound:'<div class="empty-message">\n所选地区没有符合筛选条件的排长<br />\n<\/div>',pending:'<div class="empty-message">\n正在检索…\n<\/div>',header:'<div class="empty-message">\n选择工单排长\n<\/div>'}});$("#ContractorName").val()&&(console.log($("#ContractorName").val()),$("#ContractorTypeahead").typeahead("val",$("#ContractorName").val()));$("#ContractorStaffName").val()&&$("#ContractorStaffTypeahead").typeahead("val",$("#ContractorStaffName").val());$("#ContractorTypeahead").bind("typeahead:change",function(t,r){$("#ContractorName").val()!=r&&n.search(r,function(){},function(n){for(i=0;i<n.length;i++)if(n[i].name==r){onContractorSelected(n[i]);return}$("#ContractorId").val(null);$("#ContractorName").val(r);$("#ContractorStaffId").val(null);$("#ContractorStaffName").val(null);$("#ContractorStaffPhone").val(null);$("#ContractorStaffTypeahead").typeahead("val","1");$("#ContractorStaffTypeahead").typeahead("val","");$("#ContractorStaffTypeahead").focus()})});$("#ContractorStaffTypeahead").bind("typeahead:change",function(n,r){$("#ContractorStaffName").val()!=r&&t.search(r,function(){},function(n){for(i=0;i<n.length;i++)if(n[i].name==r){onContractorStaffSelected(n[i]);return}$("#ContractorStaffId").val(null);$("#ContractorStaffName").val(r);$("#ContractorStaffPhone").val(null);$("#ContractorStaffPhone").focus()})});$("#PlatoonTypeahead").bind("typeahead:change",function(n,t){$("#PlatoonName").val()!=t&&r.search(t,function(){},function(n){for(i=0;i<n.length;i++)if(n[i].name==t){onPlatoonSelected(n[i]);return}$("#PlatoonId").val(null);$("#PlatoonName").val(null);$("#PlatoonTypeahead").typeahead("val","")})});$("#ContractorTypeahead").bind("typeahead:autocomplete ",function(n,t){onContractorSelected(t)});$("#ContractorTypeahead").bind("typeahead:select",function(n,t){onContractorSelected(t)});$("#ContractorStaffTypeahead").bind("typeahead:autocomplete ",function(n,t){onContractorStaffSelected(t)});$("#ContractorStaffTypeahead").bind("typeahead:select",function(n,t){onContractorStaffSelected(t)});$("#PlatoonTypeahead").bind("typeahead:autocomplete ",function(n,t){onPlatoonSelected(t)});$("#PlatoonTypeahead").bind("typeahead:select ",function(n,t){onPlatoonSelected(t)})}});$(document).ready(function(){$("#ModelAddOrderWorker").bind("shown.bs.modal",function(){getWorkerList()});$("#buttonAddOrderWorker").click(function(n){n.preventDefault();$("#ModelAddOrderWorker").modal("show")});var n,t=600;$("#WorkerSearchInput").bind("input",function(){window.clearTimeout(n);n=window.setTimeout(function(){getWorkerList()},t)});$(".btn-delete-worker").click(function(){event.preventDefault();$(this).parents("tr").remove()});$("#btn_set_workers").click(function(n){n.preventDefault();var i=$("#workerList").children("tr"),t,r=$.map(i,function(n){var i=$(n).attr("data-is-leader");return i&&i=="true"&&(t=$(n).attr("data-worker-id")),$(n).attr("data-worker-id")});if(!t){bootstrap_alert.danger("#SaveWorkersAlertHolder","请为工单安排班长和工人",2e3);return}$.post("../../../api/order/workers",{orderId:$("#OrderId").val(),leaderId:t,workerIds:r}).error(function(n){bootstrap_alert.danger("#SaveWorkersAlertHolder","错误（"+n.status+"）："+n.responseText,2e3)}).success(function(){window.location="../index"})});$(".btn-cancel-leader").click(function(n){n.preventDefault();$(this).text()=="设为本工单班长"?($.each($("#workerList").find("tr[data-is-leader=true]"),function(n,t){console.log(t);$(t).removeClass("text-success");$(t).attr("data-is-leader",!1);$(t).children("td").first().children("span").addClass("hidden");$(t).children("td").last().children("a").last().text("设为本工单班长");$(t).children("td").last().children("a").last().removeClass("text-success")}),$(this).text("取消本工单班长"),$(this).addClass("text-success"),$(this).parents("tr").attr("data-is-leader",!0),$(this).parents("tr").children("td").first().children("span").removeClass("hidden")):($(this).text("设为本工单班长"),$(this).removeClass("text-success"),$(this).parents("tr").attr("data-is-leader",!1),$(this).parents("tr").children("td").first().children("span").addClass("hidden"))})});$(document).ready(function(){$(".btn-del-worker").click(function(n){n.preventDefault();$(this).parents("tr").remove()})});$(document).ready(function(){var n=$("#workLoadJobCategorySelect"),t=$("#workLoadJobClassSelect");n.size()>0&&($.getJSON("../../../api/jobCategory").success(function(t){t.length>0&&(n.empty(),$.each(t,function(t,i){$("<option><\/option>").val(i.id).text(i.name).appendTo(n)}),getWorkLoadJobClassList())}),n.change(function(){getWorkLoadJobClassList()}),t.change(function(){getWorkLoadJobMeasurementList()}))});$(document).ready(function(){$(".remove-workload").click(function(){var n=$(this).val();$("#WorkLoads").find("#li_"+n).remove();$("#workLoadJobMeasurementSelect").find("#"+n).prop("checked",!1);AdjustWorkLoadHiddenInputName()})});