function random_string(n){n=n||32;var t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",u=t.length,r="";for(i=0;i<n;i++)r+=t.charAt(Math.floor(Math.random()*u));return r}function get_suffix(n){return pos=n.lastIndexOf("."),suffix="",pos!=-1&&(suffix=n.substring(pos)),suffix}function calculate_object_name(n){return g_object_name_type=="local_name"?g_object_name+="${filename}":g_object_name_type=="random_name"&&(suffix=get_suffix(n),g_object_name=g_dirname+random_string(15)+suffix),""}function get_uploaded_object_name(n){return g_object_name_type=="local_name"?(tmp_name=g_object_name,tmp_name=tmp_name.replace("${filename}",n)):g_object_name_type=="random_name"?g_object_name:void 0}function set_upload_param(n,t){g_object_name=g_dirname;t!=""&&(suffix=get_suffix(t),calculate_object_name(t));new_multipart_params={key:g_object_name,policy:policyBase64,OSSAccessKeyId:accessid,success_action_status:"200",signature:signature};n.setOption({url:host,multipart_params:new_multipart_params});n.start()}function saveCoords(n){g_w=n.w;g_h=n.h;g_x=n.x;g_y=n.y}function clearFileUi(){$("#ossfile").empty()}var policyText,policyBase64,bytes,signature,uploader;accessid="Cx6nmkDFzea2meyL";accesskey="quR4Nrj4D69nhLRPH0hfnrBjtLZlcX";host="http://ebank.oss-cn-qingdao.aliyuncs.com";g_dirname="";g_object_name="";g_object_name_type="random_name";now=timestamp=Date.parse(new Date)/1e3;g_rt_object_name="";g_x=0;g_y=0;g_w=0;g_h=0;policyText={expiration:"2020-01-01T12:00:00.000Z",conditions:[["content-length-range",0,1048576e3]]};policyBase64=Base64.encode(JSON.stringify(policyText));message=policyBase64;bytes=Crypto.HMAC(Crypto.SHA1,message,accesskey,{asBytes:!0});signature=Crypto.util.bytesToBase64(bytes);uploader=new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:"selectfiles",container:document.getElementById("container"),flash_swf_url:"lib/plupload-2.1.2/js/Moxie.swf",silverlight_xap_url:"lib/plupload-2.1.2/js/Moxie.xap",url:"http://oss.aliyuncs.com",filters:[{title:"Image files",extensions:"jpg,gif,png"},{title:"Zip files",extensions:"zip"}],init:{PostInit:function(){document.getElementById("ossfile").innerHTML=""},FilesAdded:function(n,t){plupload.each(t,function(n){document.getElementById("ossfile").innerHTML='<div id="'+n.id+'">'+n.name+" ("+plupload.formatSize(n.size)+')<b><\/b><div class="progress"><div class="progress-bar" style="width: 0%"><\/div><\/div><\/div>'});set_upload_param(uploader,"",!1)},BeforeUpload:function(n,t){set_upload_param(n,t.name,!0)},UploadProgress:function(n,t){var r=document.getElementById(t.id),u,i;r.getElementsByTagName("b")[0].innerHTML="<span>"+t.percent+"%<\/span>";u=r.getElementsByTagName("div")[0];i=u.getElementsByTagName("div")[0];i.style.width=2*t.percent+"px";i.setAttribute("aria-valuenow",t.percent)},FileUploaded:function(n,t,i){i.status==200?(g_rt_object_name=get_uploaded_object_name(t.name),document.getElementById(t.id).getElementsByTagName("b")[0].innerHTML=" 上传完毕，请剪裁头像",$("#crop-div").css("display","block"),$("#crop-container").empty().append($('<img id="portrait-origin" />')),$("#portrait-origin").prop("src","http://ebank-oss.ivmchina.net/"+g_rt_object_name),$("#portrait-origin").Jcrop({onSelect:saveCoords,onChange:saveCoords,bgColor:"black",bgOpacity:.4,setSelect:[0,0,200,200],aspectRatio:1},function(){var n=this;thumbnail=this.initComponent("Thumbnailer",{width:150,height:150});this.ui.preview=thumbnail})):document.getElementById(t.id).getElementsByTagName("b")[0].innerHTML=i.response},Error:function(){}}});uploader.init();$(document).ready(function(){$("#save-crop").click(function(n){n.preventDefault();$("#crop-div").css("display","none");var t="http://ebank-oss.ivmchina.net/"+g_rt_object_name+"?x-oss-process=image/crop,x_"+g_x+",y_"+g_y+",w_"+g_w+",h_"+g_h+"/resize,m_lfit,h_150,w_150";$("#portrait-img").prop("src",t);$("#Portrait").val(t);clearFileUi()});$("#cancel-crop").click(function(n){n.preventDefault();$("#crop-div").css("display","none");clearFileUi()})});